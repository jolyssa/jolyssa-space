<script define:vars={{ allPosts }}>
  const randomBtn = document.getElementById('random-post-btn');
  
  const handleRandomPost = (e) => {
    e?.preventDefault();
    e?.stopPropagation();
    
    console.log('[Random Button] Activated');
    
    const validPosts = allPosts.filter(post => 
      !post.data?.isTemplate && 
      post.data?.published !== false &&
      post.data?.date
    );
    
    if (validPosts.length === 0) {
      console.error('[Random Button] No valid posts');
      return;
    }
    
    const randomIndex = Math.floor(Math.random() * validPosts.length);
    const randomPost = validPosts[randomIndex];
    const url = `/${randomPost.collection}/${randomPost.slug}/`;
    
    console.log('[Random Button] Navigating to:', url);
    window.location.href = url;
  };
  
  if (randomBtn) {
    // Single unified handler
    randomBtn.addEventListener('click', handleRandomPost);
    
    // Keyboard support
    randomBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        handleRandomPost(e);
      }
    });
  }
</script>