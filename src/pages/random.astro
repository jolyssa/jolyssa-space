---
import { getCollection } from 'astro:content';

// Get all posts (excluding templates)
const music = await getCollection('music', ({ data }) => !data.isTemplate);
const making = await getCollection('making', ({ data }) => !data.isTemplate);
const thoughts = await getCollection('thoughts', ({ data }) => !data.isTemplate);
const consuming = await getCollection('consuming', ({ data }) => !data.isTemplate);
const work = await getCollection('work', ({ data }) => !data.isTemplate);

const allPosts = [
  ...music.map(p => ({ ...p, collection: 'music' })),
  ...making.map(p => ({ ...p, collection: 'making' })),
  ...thoughts.map(p => ({ ...p, collection: 'thoughts' })),
  ...consuming.map(p => ({ ...p, collection: 'consuming' })),
  ...work.map(p => ({ ...p, collection: 'work' })),
];

// Pick random post
const randomIndex = Math.floor(Math.random() * allPosts.length);
const randomPost = allPosts[randomIndex];

// Redirect to random post
return Astro.redirect(`/${randomPost.collection}/${randomPost.slug}/`);
---
